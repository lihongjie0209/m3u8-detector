# CI/CD è‡ªåŠ¨åŒ–å‘å¸ƒç³»ç»Ÿ - å®æ–½æ€»ç»“

æœ¬æ–‡æ¡£æ€»ç»“äº†ä¸º M3U8 èµ„æºæ¢æµ‹å™¨é¡¹ç›®å®æ–½çš„å®Œæ•´ CI/CD è‡ªåŠ¨åŒ–å‘å¸ƒç³»ç»Ÿã€‚

## ğŸ“¦ å·²æ·»åŠ çš„æ–‡ä»¶

### GitHub Actions å·¥ä½œæµ
```
.github/workflows/
â”œâ”€â”€ release.yml          # è‡ªåŠ¨å‘å¸ƒå·¥ä½œæµï¼ˆåŸºäº git tagï¼‰
â””â”€â”€ ci.yml              # æŒç»­é›†æˆå·¥ä½œæµï¼ˆæµ‹è¯•å’Œæ„å»ºï¼‰
```

### å‘å¸ƒè‡ªåŠ¨åŒ–è„šæœ¬
```
scripts/
â””â”€â”€ release.js          # è‡ªåŠ¨åŒ–å‘å¸ƒè„šæœ¬ï¼ˆä½¿ç”¨ gh CLIï¼‰
```

### æ–‡æ¡£
```
docs/
â”œâ”€â”€ RELEASE.md          # å®Œæ•´å‘å¸ƒæŒ‡å—ï¼ˆ400+ è¡Œï¼‰
â”œâ”€â”€ RELEASE-QUICK.md    # å¿«é€Ÿå‘å¸ƒå‚è€ƒå¡
â””â”€â”€ GITHUB-SETUP.md     # GitHub ä»“åº“è®¾ç½®æŒ‡å—

æ ¹ç›®å½•/
â””â”€â”€ CHANGELOG.md        # ç‰ˆæœ¬æ›´æ–°æ—¥å¿—æ¨¡æ¿
```

### é…ç½®æ›´æ–°
- `package.json`: æ–°å¢ 4 ä¸ªå‘å¸ƒç›¸å…³çš„ npm scripts
- `README.md`: æ·»åŠ å‘å¸ƒæµç¨‹è¯´æ˜å’Œ CI çŠ¶æ€å¾½ç« 

## ğŸš€ æ ¸å¿ƒåŠŸèƒ½

### 1. GitHub Actions è‡ªåŠ¨å‘å¸ƒ (release.yml)

**è§¦å‘æ¡ä»¶ï¼š**
- æ¨é€å½¢å¦‚ `v*.*.*` çš„ git tagï¼ˆä¾‹å¦‚ `v1.0.1`ï¼‰

**å·¥ä½œæµç¨‹ï¼š**
1. æ£€å‡ºä»£ç 
2. è®¾ç½® Node.js ç¯å¢ƒ
3. å®‰è£…ä¾èµ–ï¼ˆ`npm ci --ignore-scripts`ï¼‰
4. éªŒè¯æ–‡ä»¶å®Œæ•´æ€§ï¼ˆ`npm run validate`ï¼‰
5. æ„å»ºæ‰©å±•åŒ…ï¼ˆ`npm run build`ï¼‰
6. åˆ›å»º GitHub Release
7. ä¸Šä¼  `m3u8-detector.zip` ä½œä¸º Release èµ„äº§

**ç‰¹æ€§ï¼š**
- è‡ªåŠ¨ä» git tag æå–ç‰ˆæœ¬å·
- è‡ªåŠ¨ç”Ÿæˆ Release æ ‡é¢˜å’Œè¯´æ˜
- æ”¯æŒä½¿ç”¨ `GITHUB_TOKEN` æˆ–è‡ªå®šä¹‰ `GH_TOKEN`
- é¿å… canvas ä¾èµ–ç¼–è¯‘ï¼ˆä½¿ç”¨é¢„ç”Ÿæˆå›¾æ ‡ï¼‰

### 2. æŒç»­é›†æˆ (ci.yml)

**è§¦å‘æ¡ä»¶ï¼š**
- æ¨é€åˆ° `main` æˆ– `develop` åˆ†æ”¯
- é’ˆå¯¹ `main` æˆ– `develop` çš„ Pull Request

**æµ‹è¯•çŸ©é˜µï¼š**
- Node.js ç‰ˆæœ¬: 16.x, 18.x, 20.x
- æ“ä½œç³»ç»Ÿ: ubuntu-latest

**å·¥ä½œæµç¨‹ï¼š**
1. åœ¨ 3 ä¸ª Node.js ç‰ˆæœ¬ä¸Šæµ‹è¯•
2. å®‰è£…ä¾èµ–ï¼ˆ`npm ci --ignore-scripts`ï¼‰
3. éªŒè¯æ–‡ä»¶ï¼ˆ`npm run validate`ï¼‰
4. æ„å»ºé¡¹ç›®ï¼ˆ`npm run build`ï¼‰
5. ä¸Šä¼ æ„å»ºäº§ç‰©ï¼ˆä¿ç•™ 1 å¤©ï¼‰

### 3. æœ¬åœ°å‘å¸ƒè„šæœ¬ (release.js)

**åŠŸèƒ½ï¼š**
- æ£€æŸ¥ GitHub CLI å®‰è£…å’Œè®¤è¯
- æ£€æŸ¥å·¥ä½œç›®å½•çŠ¶æ€ï¼ˆé¿å…æœªæäº¤æ›´æ”¹ï¼‰
- æ›´æ–°ç‰ˆæœ¬å·ï¼ˆpackage.json + manifest.jsonï¼‰
- æ›´æ–° CHANGELOG.md
- æäº¤æ›´æ”¹å¹¶åˆ›å»º git tag
- æ¨é€åˆ° GitHub
- è§¦å‘ GitHub Actions è‡ªåŠ¨å‘å¸ƒ

**å‘½ä»¤è¡Œé€‰é¡¹ï¼š**
```bash
node scripts/release.js [options]

é€‰é¡¹:
  -v, --version <type>     ç‰ˆæœ¬ç±»å‹ (patch|minor|major)
  --dry-run               é¢„æ¼”æ¨¡å¼ï¼Œä¸æ‰§è¡Œå®é™…æ“ä½œ
  --skip-build            è·³è¿‡æ„å»ºæ­¥éª¤
  --skip-push             è·³è¿‡æ¨é€åˆ° GitHub
  -h, --help              æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
```

**npm å¿«æ·å‘½ä»¤ï¼š**
```bash
npm run release:patch    # 1.0.0 â†’ 1.0.1 (bug ä¿®å¤)
npm run release:minor    # 1.0.0 â†’ 1.1.0 (æ–°åŠŸèƒ½)
npm run release:major    # 1.0.0 â†’ 2.0.0 (ç ´åæ€§æ›´æ–°)
npm run release:dry      # é¢„æ¼”æ¨¡å¼
```

## ğŸ“‹ ä½¿ç”¨æµç¨‹

### é¦–æ¬¡è®¾ç½®

1. **å®‰è£… GitHub CLI**
   ```bash
   winget install GitHub.cli
   ```

2. **è®¤è¯ GitHub**
   ```bash
   gh auth login
   ```

3. **åˆå§‹åŒ–å¹¶æ¨é€ä»“åº“**
   ```bash
   git init
   git add .
   git commit -m "Initial commit: M3U8 Detector v1.0.0"
   git remote add origin https://github.com/yourusername/m3u8-detector.git
   git push -u origin main
   ```

4. **æµ‹è¯•å‘å¸ƒ**
   ```bash
   npm run release:patch
   ```

è¯¦ç»†æ­¥éª¤è§ [GITHUB-SETUP.md](GITHUB-SETUP.md)

### æ—¥å¸¸å‘å¸ƒ

```bash
# å¼€å‘å®Œæˆå
git add .
git commit -m "feat: your feature description"
git push

# å‘å¸ƒæ–°ç‰ˆæœ¬
npm run release:patch    # æˆ– minor/major
```

## ğŸ¯ å·¥ä½œåŸç†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å¼€å‘è€…æœ¬åœ°æ“ä½œ                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  npm run release:patch/minor/major  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚     scripts/release.js æ‰§è¡Œï¼š       â”‚
         â”‚  1. æ£€æŸ¥ç¯å¢ƒï¼ˆgh CLI, gitï¼‰        â”‚
         â”‚  2. æ›´æ–°ç‰ˆæœ¬å·                      â”‚
         â”‚  3. æ›´æ–° CHANGELOG                 â”‚
         â”‚  4. git commit æ›´æ”¹                â”‚
         â”‚  5. åˆ›å»º git tag (v1.0.1)          â”‚
         â”‚  6. git push + push tag            â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     GitHub ä»“åº“                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  æ£€æµ‹åˆ°æ–° tag (v1.0.1)             â”‚
         â”‚  è§¦å‘ GitHub Actions                â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  .github/workflows/release.yml     â”‚
         â”‚  1. Checkout ä»£ç                   â”‚
         â”‚  2. è®¾ç½® Node.js                   â”‚
         â”‚  3. npm ci --ignore-scripts        â”‚
         â”‚  4. npm run validate               â”‚
         â”‚  5. npm run build                  â”‚
         â”‚  6. åˆ›å»º GitHub Release            â”‚
         â”‚  7. ä¸Šä¼  m3u8-detector.zip         â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  GitHub Release åˆ›å»ºæˆåŠŸ                      â”‚
â”‚  - ç‰ˆæœ¬: v1.0.1                                              â”‚
â”‚  - é™„ä»¶: m3u8-detector.zip                                   â”‚
â”‚  - è‡ªåŠ¨ç”Ÿæˆçš„ Release Notes                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ” å®‰å…¨è€ƒè™‘

### GITHUB_TOKEN vs GH_TOKEN

- **GITHUB_TOKEN**: 
  - GitHub Actions è‡ªåŠ¨æä¾›
  - æƒé™èŒƒå›´é™å®šåœ¨å½“å‰ä»“åº“
  - **å…¬å¼€ä»“åº“æ¨èä½¿ç”¨**
  
- **GH_TOKEN**: 
  - éœ€è¦æ‰‹åŠ¨åˆ›å»º Personal Access Token
  - å¯ä»¥æœ‰æ›´å¹¿æ³›çš„æƒé™
  - é€‚ç”¨äºéœ€è¦è·¨ä»“åº“æ“ä½œæˆ–ç§æœ‰ä»“åº“

### é…ç½® GH_TOKENï¼ˆå¦‚éœ€è¦ï¼‰

1. åˆ›å»º Token: https://github.com/settings/tokens/new
2. é€‰æ‹©æƒé™: `repo`, `workflow`
3. åœ¨ä»“åº“æ·»åŠ  Secret: Settings â†’ Secrets â†’ Actions â†’ New secret
4. Name: `GH_TOKEN`, Value: ä½ çš„ token

## ğŸ“Š ç‰ˆæœ¬è§„èŒƒ

éµå¾ª [Semantic Versioning 2.0.0](https://semver.org/)ï¼š

- **MAJOR** (x.0.0): ä¸å…¼å®¹çš„ API æ›´æ”¹
- **MINOR** (0.x.0): å‘åå…¼å®¹çš„æ–°åŠŸèƒ½
- **PATCH** (0.0.x): å‘åå…¼å®¹çš„ bug ä¿®å¤

### ç‰ˆæœ¬ç±»å‹é€‰æ‹©æŒ‡å—

| æ›´æ”¹ç±»å‹ | ç‰ˆæœ¬ | ç¤ºä¾‹ |
|---------|------|------|
| Bug ä¿®å¤ | patch | ä¿®å¤é“¾æ¥å¤åˆ¶åŠŸèƒ½ |
| å°æ”¹è¿› | patch | ä¼˜åŒ– UI æ–‡æ¡ˆ |
| æ–°åŠŸèƒ½ | minor | æ·»åŠ è¿‡æ»¤åŠŸèƒ½ |
| æ€§èƒ½ä¼˜åŒ– | minor | æå‡æ£€æµ‹é€Ÿåº¦ |
| API æ›´æ”¹ | major | é‡æ„æ¶ˆæ¯ä¼ é€’æœºåˆ¶ |
| ä¾èµ–å¤§ç‰ˆæœ¬å‡çº§ | major | Manifest V3 â†’ V4 |

## ğŸ› æ•…éšœæ’é™¤

### GitHub Actions å¤±è´¥

**æ£€æŸ¥æ¸…å•ï¼š**
1. æŸ¥çœ‹ Actions æ ‡ç­¾ä¸­çš„è¯¦ç»†æ—¥å¿—
2. ç¡®è®¤ `package.json` ä¾èµ–æ­£ç¡®
3. ç¡®è®¤ `icons/` ç›®å½•ä¸­æœ‰é¢„ç”Ÿæˆçš„å›¾æ ‡
4. æ£€æŸ¥ä»“åº“ Secrets é…ç½®ï¼ˆå¦‚ä½¿ç”¨ GH_TOKENï¼‰

### release.js è„šæœ¬é”™è¯¯

**å¸¸è§é—®é¢˜ï¼š**

1. **gh å‘½ä»¤æœªæ‰¾åˆ°**
   ```bash
   winget install GitHub.cli
   ```

2. **gh æœªè®¤è¯**
   ```bash
   gh auth login
   ```

3. **æœ‰æœªæäº¤çš„æ›´æ”¹**
   ```bash
   git status
   git add .
   git commit -m "commit message"
   ```

4. **tag å·²å­˜åœ¨**
   ```bash
   # åˆ é™¤æœ¬åœ° tag
   git tag -d v1.0.1
   
   # åˆ é™¤è¿œç¨‹ tag
   git push origin :refs/tags/v1.0.1
   ```

## ğŸ“š ç›¸å…³æ–‡æ¡£

| æ–‡æ¡£ | ç”¨é€” |
|------|------|
| [RELEASE.md](RELEASE.md) | å®Œæ•´å‘å¸ƒæŒ‡å—ï¼ŒåŒ…å«æœ€ä½³å®è·µ |
| [RELEASE-QUICK.md](RELEASE-QUICK.md) | å¿«é€Ÿå‘½ä»¤å‚è€ƒ |
| [GITHUB-SETUP.md](GITHUB-SETUP.md) | GitHub ä»“åº“åˆå§‹åŒ–æŒ‡å— |
| [CHANGELOG.md](CHANGELOG.md) | ç‰ˆæœ¬å†å²è®°å½• |
| [README.md](README.md) | é¡¹ç›®ä¸»æ–‡æ¡£ |

## âœ… éªŒè¯æ¸…å•

å®Œæˆ CI/CD è®¾ç½®åï¼ŒéªŒè¯ä»¥ä¸‹é¡¹ç›®ï¼š

### æœ¬åœ°ç¯å¢ƒ
- [ ] Git å·²å®‰è£…å¹¶é…ç½®
- [ ] GitHub CLI å·²å®‰è£…
- [ ] `gh auth status` æ˜¾ç¤ºå·²è®¤è¯
- [ ] `node scripts/release.js --help` æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
- [ ] `npm run release:dry` é¢„æ¼”æˆåŠŸ

### GitHub ä»“åº“
- [ ] ä»£ç å·²æ¨é€åˆ° GitHub
- [ ] `.github/workflows/` æ–‡ä»¶å­˜åœ¨
- [ ] Actions æ ‡ç­¾å¯è§å·¥ä½œæµ
- [ ] CI å·¥ä½œæµå·²è¿è¡Œï¼ˆç»¿è‰²âœ“ï¼‰

### å‘å¸ƒæµ‹è¯•
- [ ] `npm run release:patch` æ‰§è¡ŒæˆåŠŸ
- [ ] GitHub ä¸Šå‡ºç°æ–° tag
- [ ] Release å·¥ä½œæµè§¦å‘å¹¶æˆåŠŸ
- [ ] Releases é¡µé¢æ˜¾ç¤ºæ–°ç‰ˆæœ¬
- [ ] `m3u8-detector.zip` å¯ä¸‹è½½

## ğŸ‰ æ€»ç»“

ç°åœ¨ä½ çš„é¡¹ç›®æ‹¥æœ‰äº†ï¼š

âœ… **å®Œå…¨è‡ªåŠ¨åŒ–çš„å‘å¸ƒæµç¨‹** - ä¸€ä¸ªå‘½ä»¤å®Œæˆç‰ˆæœ¬å‘å¸ƒ  
âœ… **æŒç»­é›†æˆæµ‹è¯•** - æ¯æ¬¡æäº¤è‡ªåŠ¨æµ‹è¯•  
âœ… **å¤šç‰ˆæœ¬ Node.js æ”¯æŒ** - ä¿è¯å…¼å®¹æ€§  
âœ… **GitHub Release ç®¡ç†** - è‡ªåŠ¨åˆ›å»ºå’Œç®¡ç†ç‰ˆæœ¬  
âœ… **è¯¦å°½çš„æ–‡æ¡£** - å®Œæ•´çš„æŒ‡å—å’Œå‚è€ƒ  
âœ… **æœ€ä½³å®è·µ** - éµå¾ªè¡Œä¸šæ ‡å‡†å’Œè¯­ä¹‰åŒ–ç‰ˆæœ¬  

**ä¸‹ä¸€æ­¥ï¼š**
1. æŒ‰ç…§ [GITHUB-SETUP.md](GITHUB-SETUP.md) è®¾ç½® GitHub ä»“åº“
2. æµ‹è¯•å‘å¸ƒæµç¨‹
3. å¼€å§‹å¼€å‘æ–°åŠŸèƒ½ï¼

Happy coding! ğŸš€
